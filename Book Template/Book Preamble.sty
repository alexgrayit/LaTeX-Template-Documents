% -------------------------------------------------------------
%   ------ See bottom of document to edit parameters -------  |
% -------------------------------------------------------------




% ---------------------------------------------------------------------------------------------------
% || ------------------------------------ LOTS OF PACKAGES --------------------------------------- ||
% ---------------------------------------------------------------------------------------------------

% OK just a warning - PACKAGE ORDER MATTERS - for instance the maths packages
% not being at the top breaks the compilation. LaTeX shenanigans can be annoying.


% Maths Formatting Packages - they just add extra commands
\usepackage{amsmath}
\usepackage{array} % extends array formatting
\usepackage{amssymb}
\usepackage{nccmath}
\usepackage{esint} % more integrals
\usepackage{bm} % bold math text that's not awful
\usepackage{xfrac} % slanted frac \sfrac
\usepackage{bigints}
\usepackage{tabularx}
\usepackage{cancel}
\usepackage{mathtools}%idk whether this is needed but ¯\_(ツ)_/¯



% Document/Text Formatting Packages
\usepackage{subfiles} % See https://en.wikibooks.org/wiki/LaTeX/Modular_Documents
\usepackage[a4paper, portrait, right=20mm, left=20mm, top=25mm, bottom=20mm, showframe=false]{geometry} % margins
\usepackage{booktabs} % tables - needed so that tables from latex table makers work
\usepackage{babel} % language options
\usepackage[utf8]{inputenc} % adds extra unicode characters
    \DeclareUnicodeCharacter{2212}{-}
\usepackage{dtk-logos}
\usepackage[bottom]{footmisc} %footnote customizability, [bottom] forces footnotes to the bottom
\usepackage{multicol}
\usepackage{paracol}
\usepackage{fix-cm}
\usepackage{import}
\usepackage{csquotes} % it told me to
\usepackage{xcolor} % colours yay
\usepackage{xpatch}
\usepackage{accents} % text accents
\usepackage[none]{hyphenat} % hyphenation
\usepackage{tocloft} % table of contents control
    \renewcommand{\cftsecleader}{\cftdotfill{\cftdotsep}} % adds dots between section titles and page numbers in ToC
\usepackage[justification=centering, margin=10mm]{caption} 
\usepackage{subcaption} % improves captions for subfigures
\usepackage{upgreek}


\usepackage{placeins} % Adds the \FloatBarrier command
\usepackage[hidelinks, plainpages=false, pdfpagelabels]{hyperref} % Hyperlinks - yay we live in the modern world
\usepackage{url} % adds url linking
\usepackage{nameref} % adds ability to reference sections by name
\usepackage{bookmark}

\usepackage{calc} % adds \setlength and other commands
\usepackage{lastpage} % page number referencing


\usepackage{fancyhdr} % fancy headers and footers

\usepackage[T1]{fontenc} 
\usepackage{lmodern} % fixes some font issues that happen sometimes
\usepackage{titling} % title stuff
\usepackage{titlesec} % title format customisation




% Physics Packages
\usepackage[arrowdel]{physics} % - \grad{} \div{} \curl{} \laplacian{}
\usepackage{siunitx} % adds si units \si{\unit} (it's hard to use at first, look up the documentation)


% Code Formatting Packages
\usepackage{listings} % code text environment
\usepackage{verbatim}


% Graphics Formatting Packages
\usepackage{tikz}
\usepackage{tikzscale}
    \usetikzlibrary{shapes,arrows,positioning}
    \usetikzlibrary{matrix,calc}
\usepackage{tikz-3dplot}
    \usetikzlibrary{calc,patterns,angles,quotes}
\usepackage{graphicx}
\usepackage{graphics}

\usepackage{pgfplots}
    % Dunno, it complains if this isn't here
    \pgfplotsset{compat=1.17}
\usepackage{pgf} % allows inclusion of pgf vector graphic images
\usepackage{adjustbox}


\usepackage{enumitem}
\setlist[itemize]{itemsep=0em, topsep=-0.5\parskip}
\setlist[enumerate]{itemsep=0em, topsep=-0.5\parskip}


% ---------------------------------------------------------------------------------------------------
% || --------------------------------------- REFERENCING ----------------------------------------- ||
% ---------------------------------------------------------------------------------------------------

\usepackage[backend=biber, style=phys]{biblatex}
\addbibresource{references.bib}% Syntax for version >= 1.2
% the references.bib should be in the same directory as the tex file

% Harvard style=authoryear-ibid
% APA           style=apa
% MLA           style-mla
% IEEE          style=ieee
% Physics       style=phys
% Misc. Science style=science
%
% see https://www.overleaf.com/learn/latex/Biblatex_bibliography_styles


%CREATIVE COMMONS LICENSES
\newcommand{\CCSA}{\href{https://creativecommons.org/licenses/by-sa/3.0/deed.en}{CC BY-SA 3.0}}


% ---------------------------------------------------------------------------------------------------
% || --------------------------------------- TEXT SPACING ---------------------------------------- ||
% ---------------------------------------------------------------------------------------------------

% overridden in customization at bottom
\setlength{\parindent}{0em}
\setlength{\parskip}{1em}


\newlength{\tablegap}
\setlength{\tablegap}{0.3em} % put in square brackets after i.e. \\[\tablegap]



% ---------------------------------------------------------------------------------------------------
% || ---------------------------------- CUSTOM MATHS COMMANDS ------------------------------------ ||
% ---------------------------------------------------------------------------------------------------


\setlength{\jot}{0.5em} % length between newlines of align environment

% Symbols and Notation
\newcommand{\ud}{\ \mathrm{d}}
\renewcommand{\d}{\mathrm{d}}
\newcommand{\Reals}{\mathbb{R}}
\newcommand{\Complexs}{\mathbb{C}}
\newcommand{\Integers}{\mathbb{Z}}
\newcommand{\Naturals}{\mathbb{N}}
\newcommand{\Rationals}{\mathbb{Q}}
\newcommand{\Primes}{\mathbb{P}}

\newcommand{\emf}{\mathcal{E}}

\newcommand{\deq}{\coloneqq} % defined as equal

% Size overriding - big things
\newcommand{\bfrac}[2]{\frac{\displaystyle #1}{\displaystyle #2}}
\newcommand{\bint}{\displaystyle \int}

% Vector Formatting
\newcommand{\hvec}[1]{\accentset{\rightharpoonup{}\vspace{-0.5mm}}{#1}} % harpoon above
\newcommand{\svec}[1]{\underaccent{\tilde}{#1}} % squiggle below
\newcommand{\bvec}[1]{\bm{\mathrm{#1}}}

% -Long harpoon vector
\makeatletter
\newcommand*{\rightharpoonupfill@}{\arrowfill@\relbar\relbar\rightharpoonup}
\newcommand{\lhvec}{\mathpalette{\overarrow@\rightharpoonupfill@}}
\newcommand{\lvect}[1]{\lhvec{\bvec{#1}}}%final edit here
% -end Long harpoon vector

\newcommand{\vect}[1]{\hvec{\bvec{#1}}} % used vector format
\newcommand{\vhat}[1]{\hat{\bvec{#1}}} % used hat format

\newcommand{\vmod}[1]{\left\| #1 \right\|} % modulus notation


% Vector Calculus Operators
\renewcommand{\grad}{\vect{\nabla}}
\renewcommand{\div}{\vect{\nabla} \cdot}
\renewcommand{\curl}{\vect{\nabla} \times}
\renewcommand{\laplacian}{\bvec{\nabla}^2}
\newcommand{\del}{\vect{\nabla}}

% projection operator
\DeclareMathOperator{\vectProj}{proj}
\newcommand{\proj}[2]{\vectProj_{#2} {#1}}

% Custom Matrix - better spacing
\newcommand{\Matrix}[1]{\renewcommand{\arraystretch}{1.25}
    \left[\begin{matrix}
    #1
\end{matrix}\right]
\renewcommand{\arraystretch}{1}}


%usage either \xoverline{x} or \xoverline[width percent]{x}
\makeatletter
\newsavebox\myboxA
\newsavebox\myboxB
\newlength\mylenA

\newcommand*\xoverline[2][0.75]{%
    \sbox{\myboxA}{$\m@th#2$}%
    \setbox\myboxB\null% Phantom box
    \ht\myboxB=\ht\myboxA%
    \dp\myboxB=\dp\myboxA%
    \wd\myboxB=#1\wd\myboxA% Scale phantom
    \sbox\myboxB{$\m@th\overline{\copy\myboxB}$}%  Overlined phantom
    \setlength\mylenA{\the\wd\myboxA}%   calc width diff
    \addtolength\mylenA{-\the\wd\myboxB}%
    \ifdim\wd\myboxB<\wd\myboxA%
       \rlap{\hskip 0.5\mylenA\usebox\myboxB}{\usebox\myboxA}%
    \else
        \hskip -0.5\mylenA\rlap{\usebox\myboxA}{\hskip 0.5\mylenA\usebox\myboxB}%
    \fi}
\makeatother


% ---------------------------------------------------------------------------------------------------
% || ------------------------------- INTERNAL REFERENCING COMMANDS ------------------------------- ||
% ---------------------------------------------------------------------------------------------------


\newcommand{\secrefNumName}[1]{\mbox{\hyperref[#1]{\S}\ref{#1}\hyperref[#1]{:\hspace{1pt}}\nameref{#1}}} % ref with Num:Name
\newcommand{\secrefName}[1]{\mbox{\hyperref[#1]{\S\hspace{1pt}}\nameref{#1}}} % ref with just name
\newcommand{\secrefNum}[1]{\mbox{\hyperref[#1]{\S}\ref{#1}}} % ref with just num

\newcommand{\secref}[1]{\secrefNumName{#1}} % choose method of section reference


\newcommand{\eqnum}[1]{\ref*{#1}}


% Lower case commands
\newcommand{\chapref}[1]{\mbox{\hyperref[#1]{chapter\hspace{2pt}}\ref{#1}\hyperref[#1]{:\hspace{1pt}}\nameref{#1}}}
\newcommand{\appref}[1]{\mbox{\hyperref[#1]{appendix\hspace{2pt}}\ref{#1}}}
\renewcommand{\eqref}[1]{\mbox{\hyperref[#1]{equation\hspace{2pt}}\ref{#1}}}
\newcommand{\figref}[1]{\mbox{\hyperref[#1]{figure\hspace{2pt}}\ref{#1}}}
\newcommand{\tableref}[1]{\mbox{\hyperref[#1]{table\hspace{2pt}}\ref{#1}}}

% Capitalised Commands
\newcommand{\Chapref}[1]{\mbox{\hyperref[#1]{Chapter\hspace{2pt}}\ref{#1}\hyperref[#1]{:\hspace{1pt}}\nameref{#1}}}
\newcommand{\Appref}[1]{\mbox{\hyperref[#1]{Appendix\hspace{2pt}}\ref{#1}}}
\newcommand{\Eqref}[1]{\mbox{\hyperref[#1]{Equation\hspace{2pt}}\ref{#1}}}
\newcommand{\Figref}[1]{\mbox{\hyperref[#1]{Figure\hspace{2pt}}\ref{#1}}}
\newcommand{\Tableref}[1]{\mbox{\hyperref[#1]{Table\hspace{2pt}}\ref{#1}}}


% use \cite and \textcite to do references




% ---------------------------------------------------------------------------------------------------
% || --------------------------------- HYPERLINK COLOURING --------------------------------------- ||
% ---------------------------------------------------------------------------------------------------

% overridden by customization below
\usepackage{hyperref,xcolor}
\definecolor{darkblue}{rgb}{0,0,0.6}
\hypersetup{
    %pdfpagemode=FullScreen,
    colorlinks=true,
    linkcolor=darkblue,
    filecolor=magenta,      
    urlcolor=blue,
    citecolor=black
}




% ---------------------------------------------------------------------------------------------------
% || ---------------------------------- SECTION FORMATTING --------------------------------------- ||
% ---------------------------------------------------------------------------------------------------

\setlength{\droptitle}{-8em}


\newlength{\beforechapskip}
\newlength{\chaptertopskip}
\newlength{\chapterbottomskip}
\setlength{\beforechapskip}{0mm}
\setlength{\chaptertopskip}{0mm}
\setlength{\chapterbottomskip}{10mm}

%spacing is:  left, before, after
\titlespacing{\section}{0pt}{1em}{-0.5em}
\titlespacing{\subsection}{0pt}{1em}{-0.7em}
\titlespacing{\subsubsection}{0pt}{1em}{-0.8em}
\titlespacing*{\section}{0pt}{5.5ex plus 1ex minus .2ex}{2pt}

\usepackage{bold-extra}
%\titleformat{<command>}[<shape>]{<format>}{<label>}{<sep>}{<before-code>}[<after-code>]
\titleformat{\section}{\normalfont\Large\bfseries}{\thesection}{1em}{}
\titleformat{\subsection}{\normalfont\large\bfseries}{\thesubsection}{1em}{}
\titleformat{\subsubsection}{\normalfont\normalsize\bfseries}{\thesubsubsection}{1em}{}
\titleformat{\paragraph}{\normalfont\normalsize\itshape\bfseries}{{\normalfont\normalsize\bfseries\theparagraph}}{1em}{}

% Add new sublevel
\newcommand{\subsubsubsection}[1]{\paragraph{#1}\mbox{}\\\vspace{-5em}}
% A note - this command only works well if there is an empty line after it


\newcommand{\setChapterFormatRoman}{
    \input{chapter types/Chapter Type 2.tex}
}


\newcommand{\setChapterFormatArabic}{
    \input{chapter types/Chapter Type 1.tex}
}

\newcommand{\setChapterFormatAppendix}{
    \input{chapter types/Chapter Type Appendices.tex}
}

\newcommand{\setChapterFormatReferences}{
    \input{chapter types/Chapter Type References.tex}
}






\newcommand{\ToC}{
    \setlength{\parskip}{0.2em}
    \phantomsection
    \hypertarget{ToC}{}  % Make an anchor to the toc
    \tableofcontents
    \thispagestyle{noheader}

    \newpage
    \setlength{\parskip}{1em}
}


\newcommand{\references}{
    \setcounter{secnumdepth}{-1} % levels under sublevel x are not numbered
    
    \fancyhead[LE, LO]{\headercase{References}}
    \setlength\bibitemsep{1.5\itemsep}

    \setChapterFormatReferences

    \defbibheading{SpecialBibHeadingStyle}{\chapter{References}}
    \printbibliography[heading=SpecialBibHeadingStyle]

    \setcounter{secnumdepth}{3} % levels under sublevel x are not numbered
}



% Use at start of appendix section
\newcommand{\appendices}{
    \appendix
    \fancyhead[LE, LO]{\headercase{Appendices}}

    \setChapterFormatAppendix
    \subfile{chapters/Appendices.tex}
}







% ---------------------------------------------------------------------------------------------------
% || ----------------------------------- TITLEPAGE COMMANDS -------------------------------------- ||
% ---------------------------------------------------------------------------------------------------

\makeatletter
\newcommand{\topTitle}{
    {
        \centering

        {\LARGE \@title}

        \if \@author \empty
        \else
            {\large \@author}\\
        \fi
    }
    \vspace{3em}
}



\newcommand{\fullPageTitle}{
    \begin{titlepage}
        \center
        \newcommand{\HRule}{\rule{\linewidth}{0.5mm}} % Defines a new command for the horizontal lines, change thickness here

        \vspace*{\stretch{2}}

        \HRule \\[0.4cm]
        { \HUGE \bfseries \@title}\\[0.1cm] % Title of your document
        \HRule\\[4em]

        {\Large \@author}

        \vspace{\stretch{4}} % Fill the rest of the page with whitespace

        
        \if \@date \empty
        \else
            {\large ~\@date}\\ % Date, change the \today to a set date if you want to be precise
            \vspace{4em}
        \fi
    \end{titlepage}
}
\makeatother



% ---------------------------------------------------------------------------------------------------
% || --------------------------------- MISC. DOCUMENT FORMATTING --------------------------------- ||
% ---------------------------------------------------------------------------------------------------

\let\cleardoublepage=\clearpage % stops random pages being printed after the ToC and titlepage

% Sets the maximum number of levels in the Table of Contents to x-1
\setcounter{secnumdepth}{4}

\makeatletter
\newcommand\HUGE{\@setfontsize\Huge{50}{60}}
\makeatother 


\newcommand{\super}{\textsuperscript}
\newcommand{\sub}{\textsubscript}


% Creates new column type for tables
\newcolumntype{C}[1]{>{\centering\arraybackslash}m{#1}}

% Sets the folder path for images to be a subfolder of where the .tex file is
\graphicspath{{./images/}}

% Headers and footers
\renewcommand{\chaptermark}[1]{\markboth{\large #1}{}}
\renewcommand{\sectionmark}[1]{\markright{#1}}

\pagestyle{fancy}
\fancyhf{}
\setlength{\headheight}{22pt}
\setlength{\headsep}{1.2em}
\renewcommand{\headrulewidth}{0.5pt}
\renewcommand{\footrulewidth}{0.5pt}

% overridden by customisation below
\fancyhead[LO, LE]{\headercase{\leftmark}}
\fancyfoot[RE, RO]{\small\thepage}
\fancyhead[RO, RE]{\hyperlink{ToC}{Table of Contents}}


\fancypagestyle{noheader}{
  \fancyhf{}% Clear header/footer
  \renewcommand{\headrulewidth}{0pt}% No header rule
  \fancyfoot[RE, RO]{\thepage}
}



% Equation Explanation
\newcommand{\eqexp}[1]{
    \begin{adjustwidth}{0.5cm}{1cm}
        \textsl{#1}
    \end{adjustwidth}
    \vspace{0.5em}
}









% -------------------------------------------------------------
%   --- New LaTeX users feel free to edit what is below ---   |
% -------------------------------------------------------------

% Making any of these fields blank will remove them from the titlepage
\newcommand{\BookName}{Book Name}

\author{Author 1, Author 2, Author 3}

\date{} % makes it undated, remove this line if you want a date to appear
%\date{\today} % make the date the current date





% ----------------------------------------------------------------------
%   --- Semi-Advanced LaTeX users feel free to edit what is below ---  |
% ----------------------------------------------------------------------

\title{\BookName}

% Formatting
\numberwithin{equation}{chapter} % numbers equation with secNum.EqNum, remove to number globally

\setlength{\parindent}{0em} % indent when there is a double newline within the tex code
\setlength{\parskip}{1em} % vertical space when there is a double newline within the text code


\usepackage{hyperref,xcolor}
\hypersetup{
    colorlinks=true,
    linkcolor=darkblue,
    filecolor=magenta,      
    urlcolor=blue,
    citecolor=black
}


\newcommand{\headercase}[1]{\large\scshape\nouppercase #1}
\fancyhead[LO, LE]{\headercase{\leftmark}}
\fancyfoot[RE, RO]{\small\thepage}
\fancyhead[RO, RE]{\hyperlink{ToC}{Table of Contents}}




% -----------------------------------------------------------------
%   --- Advanced LaTeX users... do what you want ¯\_(ツ)_/¯ ---   |
% -----------------------------------------------------------------